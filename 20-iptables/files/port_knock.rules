# Generated by iptables-save v1.8.4 on Wed Feb  1 09:20:01 2023
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:pass_step_1 - [0:0]
:pass_step_2 - [0:0]
:pass_step_3 - [0:0]
:port_knock - [0:0]
-A INPUT -p icmp -m icmp --icmp-type any -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -j port_knock
-A pass_step_1 -p tcp -j LOG --log-prefix "[in pass_step_1] "
-A pass_step_1 -m recent --set --name IP_LIST1 --mask 255.255.255.255 --rsource -j DROP
-A pass_step_2 -p tcp -j LOG --log-prefix "[in pass_step_2] "
-A pass_step_2 -m recent --set --name IP_LIST2 --mask 255.255.255.255 --rsource -j DROP
-A pass_step_3 -p tcp -j LOG --log-prefix "[in pass_step_3] "
-A pass_step_3 -m recent --set --name IP_LIST3 --mask 255.255.255.255 --rsource -j DROP
-A port_knock -p tcp -j LOG --log-prefix "[before step4] "
-A port_knock -p tcp -m tcp --dport 22 -m conntrack --ctstate NEW -m recent --rcheck --seconds 30 --name IP_LIST3 --mask 255.255.255.255 --rsource -j ACCEPT
-A port_knock -p tcp -m conntrack --ctstate NEW -m recent --remove --name IP_LIST3 --mask 255.255.255.255 --rsource -j DROP
-A port_knock -p tcp -j LOG --log-prefix "[before step3] "
-A port_knock -p tcp -m tcp --dport 9999 -m conntrack --ctstate NEW -m recent --rcheck --name IP_LIST2 --mask 255.255.255.255 --rsource -j pass_step_3
-A port_knock -p tcp -m conntrack --ctstate NEW -m recent --remove --name IP_LIST2 --mask 255.255.255.255 --rsource -j DROP
-A port_knock -p tcp -j LOG --log-prefix "[before step2] "
-A port_knock -p tcp -m tcp --dport 8888 -m conntrack --ctstate NEW -m recent --rcheck --name IP_LIST1 --mask 255.255.255.255 --rsource -j pass_step_2
-A port_knock -p tcp -m conntrack --ctstate NEW -m recent --remove --name IP_LIST1 --mask 255.255.255.255 --rsource -j DROP
-A port_knock -p tcp -j LOG --log-prefix "[before step1] "
-A port_knock -p tcp -m tcp --dport 7777 -m conntrack --ctstate NEW -j pass_step_1
COMMIT
# Completed on Wed Feb  1 09:20:01 2023
